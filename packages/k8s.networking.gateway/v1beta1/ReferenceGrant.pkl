//===----------------------------------------------------------------------===//
// Copyright Â© 2026 Apple Inc. and the Pkl project authors. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     https://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//===----------------------------------------------------------------------===//
/// ReferenceGrant identifies kinds of resources in other namespaces that are
/// trusted to reference the specified kinds of resources in the same namespace
/// as the policy.
///
/// Each ReferenceGrant can be used to represent a unique trust relationship.
/// Additional Reference Grants can be used to add to the set of trusted
/// sources of inbound references for the namespace they are defined within.
///
/// All cross-namespace references in Gateway API (with the exception of cross-namespace
/// Gateway-route attachment) require a ReferenceGrant.
///
/// ReferenceGrant is a form of runtime verification allowing users to assert
/// which cross-namespace object references are permitted. Implementations that
/// support ReferenceGrant MUST NOT permit cross-namespace references which have
/// no grant, and MUST respond to the removal of a grant by revoking the access
/// that the grant allowed.
module k8s.networking.gateway.v1beta1.ReferenceGrant

extends "@k8s/K8sResource.pkl"

import "@k8s/apimachinery/pkg/apis/meta/v1/ObjectMeta.pkl"

fixed apiVersion: "gateway.networking.k8s.io/v1beta1"

fixed kind: "ReferenceGrant"

/// Standard object's metadata.
///
/// More info: <https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata>.
metadata: ObjectMeta?

/// Spec defines the desired state of ReferenceGrant.
spec: Spec?

/// Spec defines the desired state of ReferenceGrant.
class Spec {
  /// From describes the trusted namespaces and kinds that can reference the
  /// resources described in "To". Each entry in this list MUST be considered
  /// to be an additional place that references can be valid from, or to put
  /// this another way, entries MUST be combined using OR.
  ///
  /// Support: Core
  from: Listing<From>(length.isBetween(1, 16))

  /// To describes the resources that may be referenced by the resources
  /// described in "From". Each entry in this list MUST be considered to be an
  /// additional place that references can be valid to, or to put this another
  /// way, entries MUST be combined using OR.
  ///
  /// Support: Core
  to: Listing<To>(length.isBetween(1, 16))
}

/// ReferenceGrantFrom describes trusted namespaces and kinds.
class From {
  /// Group is the group of the referent.
  /// When empty, the Kubernetes core API group is inferred.
  ///
  /// Support: Core
  group: String(
    length <= 253,
    matches(Regex(#"^$|^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$"#))
  )

  /// Kind is the kind of the referent. Although implementations may support
  /// additional resources, the following types are part of the "Core"
  /// support level for this field.
  ///
  /// When used to permit a SecretObjectReference:
  ///
  /// * Gateway
  ///
  /// When used to permit a BackendObjectReference:
  ///
  /// * GRPCRoute
  /// * HTTPRoute
  /// * TCPRoute
  /// * TLSRoute
  /// * UDPRoute
  kind: String(length.isBetween(1, 63), matches(Regex("^[a-zA-Z]([-a-zA-Z0-9]*[a-zA-Z0-9])?$")))

  /// Namespace is the namespace of the referent.
  ///
  /// Support: Core
  namespace: String(length.isBetween(1, 63), matches(Regex("^[a-z0-9]([-a-z0-9]*[a-z0-9])?$")))
}

/// ReferenceGrantTo describes what Kinds are allowed as targets of the
/// references.
class To {
  /// Group is the group of the referent.
  /// When empty, the Kubernetes core API group is inferred.
  ///
  /// Support: Core
  group: String(
    length <= 253,
    matches(Regex(#"^$|^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$"#))
  )

  /// Kind is the kind of the referent. Although implementations may support
  /// additional resources, the following types are part of the "Core"
  /// support level for this field:
  ///
  /// * Secret when used to permit a SecretObjectReference
  /// * Service when used to permit a BackendObjectReference
  kind: String(length.isBetween(1, 63), matches(Regex("^[a-zA-Z]([-a-zA-Z0-9]*[a-zA-Z0-9])?$")))

  /// Name is the name of the referent. When unspecified, this policy
  /// refers to all resources of the specified Group and Kind in the local
  /// namespace.
  name: String(length.isBetween(1, 253))?
}
