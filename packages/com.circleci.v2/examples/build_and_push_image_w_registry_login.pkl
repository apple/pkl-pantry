amends ".../Config.pkl"

version = "2.1"

orbs {
  ["aws-ecr"] = "circleci/aws-ecr@9.0"
  ["aws-cli"] = "circleci/aws-cli@5.1"
}

workflows {
  ["build-and-push-image-with-container-registry-login"] {
    jobs {
      new {
        ["aws-ecr/build_and_push_image"] {
          parameters {
            ["container_registry_login"] = true
            ["registry_login"] {
              module.run("docker login -u ${HEROKU_USERNAME} -p ${HEROKU_API_KEY}")
              module.run("docker login -u ${GITHUB_USERNAME} -p ${GITHUB_TOKEN}")
              module.run("docker login -u ${DOCKERHUB_ID} -p ${DOCKERHUB_PASSWORD}")
            }
            ["auth"] {
              (module.OrbStep("aws-cli/setup")) {
                role_arn = "arn:aws:iam::123456789012"
              }
            }
            ["repo"] = "my-sample-repo"
            ["tag"] = "sampleTag"
            ["dockerfile"] = "Dockerfile"
            ["path"] = "."
            ["region"] = "us-west-2"
          }
        }
      }
    }
  }
}